#!/usr/bin/env perl
use warnings;
use strict;
use lib '/usr/lib/perl5';
use lib '/usr/lib/perl5/Shiloh';
use lib '/usr/lib/perl5/site_perl';
use Shiloh::Eee::Console;
use Shiloh::Eee::Sound::Mixer;

my $SUDO = &get_sudo();

my $mixer = Mixer->new();
# $mixer->volume(100);

my $console = Console->new();


$console->set();

use Net::NTP;
my %response = get_ntp_response('pool.ntp.org');
foreach my $key ( keys %response ) {
#    print "$key\t$response{$key}\n";
}
my $time = time;
my $ntp_time = $response{'Transmit Timestamp'};
my $date = scalar localtime($ntp_time);
print "Perl says date is $date\n";
print `$SUDO date --set='$date'`;
system("$SUDO /sbin/hwclock --systohc");

sub get_sudo {
    if ( $ENV{"USER"} ne 'root') {
	return '/usr/bin/sudo';
    }	else {
	return '';
    }
}
